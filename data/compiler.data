project { author "ve5li" contact "ve5li@tuta.io" name "liquify" } directories { core "/usr/share/liquify/data/core/" pass "/usr/share/liquify/data/passes/" utility "/usr/share/shego/data/" } extentions { data "data" liquify "liq" } command_lookup { caching { default !true environment "LIQUIFY_ENABLE_CACHING" flag "-c" long "--no-caching" once !true } debug { default !false environment "LIQUIFY_DEBUG" flag "-d" long "--debug" once !true } help { default !false environment "LIQUIFY_SHOW_HELP" flag "-h" long "--help" once !false } output { default "data/" environment "LIQUIFY_OUTPUT_DIRECTORY" flag "-o" long "--output" once !true } source { default "source/" environment "LIQUIFY_SOURCE_DIRECTORY" flag "-s" long "--source" once !true } } #functions { debug_log [ [ #single debug [ boolean ] ] [ #list arguments ] #if [ #data #true ] [ #scope:debug ] #call_list [ #data #print:debug ] [ #scope:arguments ] #end ] load_cache [ [ #single debug [ boolean ] ] #environment [ #data "HOME" ] #modify [ #data #scope:_0 ] [ #last ] #string [ #scope:_0 ] [ #data "/.cache/liquify." ] [ #root:extentions:data ] #modify [ #data #scope:_1 ] [ #last ] #modify [ #data #scope:cache_file ] [ #scope:_1 ] #string [ #data "loading cache from file " ] [ #root:#color:magenta ] [ #scope:cache_file ] [ #root:#color:none ] #modify [ #data #scope:_2 ] [ #last ] #call [ #data debug_log ] [ #scope:debug ] [ #scope:_2 ] #silent [ #data "touch" ] [ #scope:cache_file ] #read_map [ #scope:cache_file ] #return [ #last ] ] save_cache [ [ #single debug [ boolean ] ] [ #single cache [ map ] ] #environment [ #data "HOME" ] #modify [ #data #scope:_0 ] [ #last ] #string [ #scope:_0 ] [ #data "/.cache/liquify." ] [ #root:extentions:data ] #modify [ #data #scope:_1 ] [ #last ] #modify [ #data #scope:cache_file ] [ #scope:_1 ] #string [ #data "saving cache to file " ] [ #root:#color:magenta ] [ #scope:cache_file ] [ #root:#color:none ] #modify [ #data #scope:_2 ] [ #last ] #call [ #data debug_log ] [ #scope:debug ] [ #scope:_2 ] #write_map [ #scope:cache_file ] [ #scope:cache ] ] show_help [ #print_line #print_line [ #data "usage:" ] #print_line [ #data "  $         liquify [options]" ] #print_line #print_line [ #data "options:" ] #print_line [ #data " -h         show help menu" ] #print_line [ #data " -c         disable caching" ] #print_line [ #data " -d         turn on debug mode" ] #print_line [ #data " -s         set source directory" ] #print_line [ #data " -o         set output directory" ] #print_line #print_line [ #data "contact:" ] #print_line [ #data "  #         github.com/ve5li/liquify" ] #print_line [ #data "  @         ve5li@tuta.io" ] #print_line ] #main [ [ #list arguments [ string ] ] #time #modify [ #data #scope:_0 ] [ #last ] #modify [ #data #scope:start_time ] [ #scope:_0 ] #modify [ #data #scope:dependencies ] [ #data [ format color debug interface ] ] #iterate [ #scope:dependencies ] #modify [ #data #scope:key ] [ #last:key ] [ #data #scope:file ] [ #last:value ] #string [ #root:directories:utility ] [ #scope:file ] [ #data '.' ] [ #root:extentions:data ] #modify [ #data #scope:_1 ] [ #last ] #read_map [ #scope:_1 ] #modify [ #data #scope:_2 ] [ #last ] #modify [ #data #scope:library_data ] [ #scope:_2 ] #merge [ #root ] [ #scope:library_data ] #modify [ #data #scope:_3 ] [ #last ] #modify [ #data #root ] [ #scope:_3 ] #end #call [ #data #interface:process_arguments ] [ #root:command_lookup ] [ #scope:arguments ] #modify [ #data #scope:_4 ] [ #last ] #modify [ #data #scope:configuration ] [ #scope:_4 ] #modify [ #data #root:debug ] [ #scope:configuration:debug ] #if [ #data #true ] [ #scope:configuration:help ] #call [ #data show_help ] #return #end #modify [ #data #scope:compiler_core ] [ #data [ tokenizer parser ] ] #modify [ #data #scope:compiler_pipeline ] [ #data [ resolve ] ] #modify [ #data #scope:compiler_dependencies ] [ #data [ format color debug position ] ] #map [ #data debug ] [ #scope:configuration:debug ] [ #data #pipeline ] [ #scope:compiler_pipeline ] #modify [ #data #scope:_5 ] [ #last ] #modify [ #data #scope:compiler ] [ #scope:_5 ] #iterate [ #scope:compiler_core ] #modify [ #data #scope:key ] [ #last:key ] [ #data #scope:file ] [ #last:value ] #string [ #root:directories:core ] [ #scope:file ] [ #data '.' ] [ #root:extentions:data ] #modify [ #data #scope:_6 ] [ #last ] #read_map [ #scope:_6 ] #modify [ #data #scope:_7 ] [ #last ] #modify [ #data #scope:core_data ] [ #scope:_7 ] #merge [ #scope:compiler ] [ #scope:core_data ] #modify [ #data #scope:_8 ] [ #last ] #modify [ #data #scope:compiler ] [ #scope:_8 ] #end #iterate [ #scope:compiler_dependencies ] #modify [ #data #scope:key ] [ #last:key ] [ #data #scope:file ] [ #last:value ] #string [ #root:directories:utility ] [ #scope:file ] [ #data '.' ] [ #root:extentions:data ] #modify [ #data #scope:_9 ] [ #last ] #read_map [ #scope:_9 ] #modify [ #data #scope:_10 ] [ #last ] #modify [ #data #scope:library_data ] [ #scope:_10 ] #merge [ #scope:compiler ] [ #scope:library_data ] #modify [ #data #scope:_11 ] [ #last ] #modify [ #data #scope:compiler ] [ #scope:_11 ] #merge [ #root ] [ #scope:library_data ] #modify [ #data #scope:_12 ] [ #last ] #modify [ #data #root ] [ #scope:_12 ] #end #call [ #data debug_log ] [ #scope:configuration:debug ] [ #data "libraries loaded" ] #call [ #data debug_log ] [ #scope:configuration:debug ] [ #data "loading the pipeline" ] #iterate [ #scope:compiler:#pipeline ] #modify [ #data #scope:key ] [ #last:key ] [ #data #scope:pass ] [ #last:value ] #string [ #data "loading pass " ] [ #scope:pass ] #modify [ #data #scope:_13 ] [ #last ] #call [ #data debug_log ] [ #scope:configuration:debug ] [ #scope:_13 ] #string [ #root:directories:pass ] [ #scope:pass ] [ #data '.' ] [ #root:extentions:data ] #modify [ #data #scope:_14 ] [ #last ] #read_map [ #scope:_14 ] #modify [ #data #scope:_15 ] [ #last ] #modify [ #data #scope:pass_data ] [ #scope:_15 ] #merge [ #scope:compiler ] [ #scope:pass_data ] #modify [ #data #scope:_16 ] [ #last ] #modify [ #data #scope:compiler ] [ #scope:_16 ] #end #if [ #data #true ] [ #scope:configuration:caching ] #call [ #data load_cache ] [ #scope:configuration:debug ] #modify [ #data #scope:_17 ] [ #last ] #modify [ #data #scope:cache ] [ #scope:_17 ] #end #silent [ #data "cp" ] [ #data "-r" ] [ #data "-T" ] [ #scope:configuration:source ] [ #scope:configuration:output ] #string [ #data "*." ] [ #root:extentions:liquify ] #modify [ #data #scope:_18 ] [ #last ] #silent [ #data "find" ] [ #scope:configuration:output ] [ #data "-name" ] [ #scope:_18 ] #modify [ #data #scope:_19 ] [ #last ] #modify [ #data #scope:result ] [ #scope:_19 ] #split [ #scope:result:output ] [ #data '\n' ] [ #data !true ] #modify [ #data #scope:_20 ] [ #last ] #modify [ #data #scope:files ] [ #scope:_20 ] #iterate [ #scope:files ] #modify [ #data #scope:key ] [ #last:key ] [ #data #scope:input_file ] [ #last:value ] #slice [ #scope:input_file ] [ #data 1 ] [ #data -4 ] #modify [ #data #scope:_21 ] [ #last ] #string [ #scope:_21 ] [ #root:extentions:data ] #modify [ #data #scope:_22 ] [ #last ] #modify [ #data #scope:output_file ] [ #scope:_22 ] #read_file [ #scope:input_file ] #modify [ #data #scope:_23 ] [ #last ] #modify [ #data #scope:content ] [ #scope:_23 ] #if [ #data #true ] [ #scope:configuration:caching ] #boolean [ #data #present ] [ #scope:cache ] [ #scope:input_file ] #if [ #data #true ] [ #last ] #index [ #scope:cache ] [ #scope:input_file ] #modify [ #data #scope:_24 ] [ #last ] #index [ #scope:_24 ] [ #data source ] #modify [ #data #scope:_25 ] [ #last ] #boolean [ #data #equals ] [ #scope:_25 ] [ #scope:content ] #if [ #data #true ] [ #last ] #silent [ #data "rm" ] [ #scope:input_file ] #index [ #scope:cache ] [ #scope:input_file ] #modify [ #data #scope:_26 ] [ #last ] #index [ #scope:_26 ] [ #data compiled ] #modify [ #data #scope:_27 ] [ #last ] #write_file [ #scope:output_file ] [ #scope:_27 ] #continue #end #end #end #string [ #data "compiling file " ] [ #root:#color:cyan ] [ #scope:input_file ] [ #root:#color:none ] #modify [ #data #scope:_28 ] [ #last ] #call [ #data #print:color ] [ #root:#color:cyan ] [ #data "build" ] [ #scope:_28 ] #call [ #data debug_log ] [ #scope:configuration:debug ] [ #data "tokenizing... " ] #tokenize [ #scope:compiler ] [ #scope:content ] [ #scope:input_file ] [ #data !false ] [ #data !true ] #modify [ #data #scope:_29 ] [ #last ] #modify [ #data #scope:tokenizer_data ] [ #scope:_29 ] #call [ #data debug_log ] [ #scope:configuration:debug ] [ #data "parsing... " ] #parse [ #scope:compiler ] [ #scope:tokenizer_data:token_stream ] [ #scope:tokenizer_data:registry ] #modify [ #data #scope:_30 ] [ #last ] #modify [ #data #scope:parser_data ] [ #scope:_30 ] #call [ #data debug_log ] [ #scope:configuration:debug ] [ #data "building... " ] #build [ #scope:compiler ] [ #scope:parser_data ] #modify [ #data #scope:_31 ] [ #last ] #modify [ #data #scope:build_data ] [ #scope:_31 ] #write_file [ #scope:output_file ] [ #scope:build_data:code ] #silent [ #data "rm" ] [ #scope:input_file ] #if [ #data #true ] [ #scope:configuration:caching ] #map [ #data source ] [ #scope:content ] [ #data compiled ] [ #scope:build_data:code ] #modify [ #data #scope:_32 ] [ #last ] #modify [ #data #scope:entry ] [ #scope:_32 ] #overwrite [ #scope:cache ] [ #scope:input_file ] [ #scope:entry ] #modify [ #data #scope:_33 ] [ #last ] #modify [ #data #scope:cache ] [ #scope:_33 ] #end #end #if [ #data #true ] [ #scope:configuration:caching ] #call [ #data save_cache ] [ #scope:configuration:debug ] [ #scope:cache ] #end #time #modify [ #data #scope:_34 ] [ #last ] #subtract [ #scope:_34 ] [ #scope:start_time ] #modify [ #data #scope:_35 ] [ #last ] #divide [ #scope:_35 ] [ #data 1000.0 ] #modify [ #data #scope:_36 ] [ #last ] #modify [ #data #scope:delta_time ] [ #scope:_36 ] #string [ #scope:delta_time ] #modify [ #data #scope:_37 ] [ #last ] #slice [ #scope:_37 ] [ #data 1 ] [ #data 3 ] #modify [ #data #scope:_38 ] [ #last ] #modify [ #data #scope:formatted ] [ #scope:_38 ] #string [ #data "completed in " ] [ #scope:formatted ] [ #data "s" ] #modify [ #data #scope:_39 ] [ #last ] #call [ #data #print:success ] [ #scope:_39 ] ] } 