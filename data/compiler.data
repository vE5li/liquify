core [ tokenizer parser ] dependencies [ format file color debug position ] pipeline [ resolve ] project { author "ve5li" contact "ve5li@tuta.io" name "liquify" } directory { core "/usr/share/liquify/data/core/" pass "/usr/share/liquify/data/passes/" utility "/usr/share/shego/library/" } #functions { debug_log [ [ #single debug ] [ #list arguments ] #if [ #data #true ] [ #scope:debug ] #call_list [ #data #print:debug ] [ #scope:arguments ] #end ] load_cache [ [ #single debug ] #environment [ #data "HOME" ] #modify [ #data #scope:_0 ] [ #last ] #string [ #scope:_0 ] [ #data "/.cache/liquify" ] #modify [ #data #scope:cache_file ] [ #last ] #string [ #data "loading cache from file " ] [ #root:#color:magenta ] [ #scope:cache_file ] [ #root:#color:none ] #modify [ #data #scope:_1 ] [ #last ] #call [ #data debug_log ] [ #scope:debug ] [ #scope:_1 ] #system [ #data "touch" ] [ #scope:cache_file ] #read_map [ #scope:cache_file ] #return [ #last ] ] process_arguments [ [ #single arguments ] #modify [ #data #scope:configuration ] [ #data { caching !true debug !false files [ ] help !false output "data/" source "source/" } ] #length [ #scope:arguments ] #modify [ #data #scope:count ] [ #last ] #modify [ #data #scope:index ] [ #data 1 ] #boolean [ #data #not_bigger ] [ #scope:index ] [ #scope:count ] #modify [ #data #scope:_0 ] [ #last ] #while [ #data #true ] [ #scope:_0 ] #index [ #scope:arguments ] [ #scope:index ] #modify [ #data #scope:argument ] [ #last ] #boolean [ #data #equals ] [ #scope:argument ] [ #data "-h" ] #if [ #data #true ] [ #last ] #modify [ #data #scope:configuration:help ] [ #data !true ] #else #boolean [ #data #equals ] [ #scope:argument ] [ #data "-s" ] #if [ #data #true ] [ #last ] #boolean [ #data #bigger ] [ #scope:count ] [ #scope:index ] #modify [ #data #scope:_1 ] [ #last ] #ensure [ #data #true ] [ #scope:_1 ] [ #data "expected source directory" ] #boolean [ #data #not_present ] [ #scope ] [ #data source_set ] #modify [ #data #scope:_2 ] [ #last ] #ensure [ #data #true ] [ #scope:_2 ] [ #data "source directory may only be set once" ] #add [ #scope:index ] [ #data 1 ] #modify [ #data #scope:index ] [ #last ] #index [ #scope:arguments ] [ #scope:index ] #modify [ #data #scope:configuration:source ] [ #last ] #modify [ #data #scope:source_set ] [ #data !true ] #else #boolean [ #data #equals ] [ #scope:argument ] [ #data "-o" ] #if [ #data #true ] [ #last ] #boolean [ #data #bigger ] [ #scope:count ] [ #scope:index ] #modify [ #data #scope:_3 ] [ #last ] #ensure [ #data #true ] [ #scope:_3 ] [ #data "expected output directory" ] #boolean [ #data #not_present ] [ #scope ] [ #data output_set ] #modify [ #data #scope:_4 ] [ #last ] #ensure [ #data #true ] [ #scope:_4 ] [ #data "output directory may only be set once" ] #add [ #scope:index ] [ #data 1 ] #modify [ #data #scope:index ] [ #last ] #index [ #scope:arguments ] [ #scope:index ] #modify [ #data #scope:configuration:output ] [ #last ] #modify [ #data #scope:output_set ] [ #data !true ] #else #boolean [ #data #equals ] [ #scope:argument ] [ #data "-c" ] #if [ #data #true ] [ #last ] #boolean [ #data #not_present ] [ #scope ] [ #data caching_set ] #modify [ #data #scope:_5 ] [ #last ] #ensure [ #data #true ] [ #scope:_5 ] [ #data "disable caching flag may only be set once" ] #modify [ #data #scope:configuration:caching ] [ #data !false ] #modify [ #data #scope:caching_set ] [ #data !true ] #else #boolean [ #data #equals ] [ #scope:argument ] [ #data "-d" ] #if [ #data #true ] [ #last ] #boolean [ #data #not_present ] [ #scope ] [ #data debug_set ] #modify [ #data #scope:_6 ] [ #last ] #ensure [ #data #true ] [ #scope:_6 ] [ #data "debug flag may only be set once" ] #modify [ #data #scope:configuration:debug ] [ #data !true ] #modify [ #data #scope:debug_set ] [ #data !true ] #else #string [ #data "invalid flag " ] [ #scope:argument ] #modify [ #data #scope:_7 ] [ #last ] #print_line [ #scope:_7 ] #modify [ #data #scope:configuration:help ] [ #data !true ] #break #end #end #end #end #end #add [ #scope:index ] [ #data 1 ] #modify [ #data #scope:index ] [ #last ] #boolean [ #data #not_bigger ] [ #scope:index ] [ #scope:count ] #modify [ #data #scope:_0 ] [ #last ] #end #return [ #scope:configuration ] ] save_cache [ [ #single debug ] [ #single cache ] #environment [ #data "HOME" ] #modify [ #data #scope:_0 ] [ #last ] #string [ #scope:_0 ] [ #data "/.cache/liquify" ] #modify [ #data #scope:cache_file ] [ #last ] #string [ #data "saving cache to file " ] [ #root:#color:magenta ] [ #scope:cache_file ] [ #root:#color:none ] #modify [ #data #scope:_1 ] [ #last ] #call [ #data debug_log ] [ #scope:debug ] [ #scope:_1 ] #write_map [ #scope:cache_file ] [ #scope:cache ] ] show_help [ #print_line #print_line [ #data "usage:" ] #print_line [ #data "  $         liquify [options]" ] #print_line #print_line [ #data "options:" ] #print_line [ #data " -h         show help menu" ] #print_line [ #data " -c         disable caching" ] #print_line [ #data " -d         turn on debug mode" ] #print_line [ #data " -s         set source directory" ] #print_line [ #data " -o         set output directory" ] #print_line #print_line [ #data "contact:" ] #print_line [ #data "  #         github.com/ve5li/liquify" ] #print_line [ #data "  @         ve5li@tuta.io" ] #print_line ] #main [ [ #list arguments ] #time #modify [ #data #scope:start_time ] [ #last ] #call [ #data process_arguments ] [ #scope:arguments ] #modify [ #data #scope:configuration ] [ #last ] #if [ #data #true ] [ #scope:configuration:help ] #call [ #data show_help ] #return #end #map [ #data debug ] [ #scope:configuration:debug ] [ #data #pipeline ] [ #root:pipeline ] #modify [ #data #scope:compiler ] [ #last ] #iterate [ #root:core ] #modify [ #data #scope:key ] [ #last:key ] [ #data #scope:file ] [ #last:value ] #string [ #root:directory:core ] [ #scope:file ] [ #data ".data" ] #modify [ #data #scope:_0 ] [ #last ] #read_map [ #scope:_0 ] #modify [ #data #scope:core_data ] [ #last ] #merge [ #scope:compiler ] [ #scope:core_data ] #modify [ #data #scope:compiler ] [ #last ] #end #iterate [ #root:dependencies ] #modify [ #data #scope:key ] [ #last:key ] [ #data #scope:file ] [ #last:value ] #string [ #root:directory:utility ] [ #scope:file ] [ #data ".data" ] #modify [ #data #scope:_1 ] [ #last ] #read_map [ #scope:_1 ] #modify [ #data #scope:library_data ] [ #last ] #merge [ #scope:compiler ] [ #scope:library_data ] #modify [ #data #scope:compiler ] [ #last ] #merge [ #root ] [ #scope:library_data ] #modify [ #data #root ] [ #last ] #end #call [ #data debug_log ] [ #scope:configuration:debug ] [ #data "libraries loaded" ] #call [ #data debug_log ] [ #scope:configuration:debug ] [ #data "loading the pipeline" ] #iterate [ #scope:compiler:#pipeline ] #modify [ #data #scope:key ] [ #last:key ] [ #data #scope:pass ] [ #last:value ] #string [ #data "loading pass " ] [ #scope:pass ] #modify [ #data #scope:_2 ] [ #last ] #call [ #data debug_log ] [ #scope:configuration:debug ] [ #scope:_2 ] #string [ #root:directory:pass ] [ #scope:pass ] [ #data ".data" ] #modify [ #data #scope:_3 ] [ #last ] #read_map [ #scope:_3 ] #modify [ #data #scope:pass_data ] [ #last ] #merge [ #scope:compiler ] [ #scope:pass_data ] #modify [ #data #scope:compiler ] [ #last ] #end #if [ #data #true ] [ #scope:configuration:caching ] #call [ #data load_cache ] [ #scope:configuration:debug ] #modify [ #data #scope:cache ] [ #last ] #end #system [ #data "cp" ] [ #data "-r" ] [ #data "-T" ] [ #scope:configuration:source ] [ #scope:configuration:output ] #system [ #data "find" ] [ #scope:configuration:output ] [ #data "-name" ] [ #data "*.liq" ] #modify [ #data #scope:result ] [ #last ] #split [ #scope:result:output ] [ #data '\n' ] [ #data !true ] #modify [ #data #scope:files ] [ #last ] #iterate [ #scope:files ] #modify [ #data #scope:key ] [ #last:key ] [ #data #scope:input_file ] [ #last:value ] #slice [ #scope:input_file ] [ #data 1 ] [ #data -4 ] #modify [ #data #scope:_4 ] [ #last ] #string [ #scope:_4 ] [ #data "data" ] #modify [ #data #scope:output_file ] [ #last ] #read_file [ #scope:input_file ] #modify [ #data #scope:content ] [ #last ] #if [ #data #true ] [ #scope:configuration:caching ] #boolean [ #data #present ] [ #scope:cache ] [ #scope:input_file ] #if [ #data #true ] [ #last ] #index [ #scope:cache ] [ #scope:input_file ] #modify [ #data #scope:_5 ] [ #last ] #index [ #scope:_5 ] [ #data source ] #modify [ #data #scope:_6 ] [ #last ] #boolean [ #data #equals ] [ #scope:_6 ] [ #scope:content ] #if [ #data #true ] [ #last ] #system [ #data "rm" ] [ #scope:input_file ] #index [ #scope:cache ] [ #scope:input_file ] #modify [ #data #scope:_7 ] [ #last ] #index [ #scope:_7 ] [ #data compiled ] #modify [ #data #scope:_8 ] [ #last ] #write_file [ #scope:output_file ] [ #scope:_8 ] #continue #end #end #end #string [ #data "compiling file " ] [ #scope:input_file ] #modify [ #data #scope:_9 ] [ #last ] #call [ #data #print:color ] [ #root:#color:cyan ] [ #data "build" ] [ #scope:_9 ] #call [ #data debug_log ] [ #scope:configuration:debug ] [ #data "tokenizing... " ] #tokenize [ #scope:compiler ] [ #scope:content ] [ #scope:input_file ] [ #data !false ] #modify [ #data #scope:tokenizer_data ] [ #last ] #call [ #data debug_log ] [ #scope:configuration:debug ] [ #data "parsing... " ] #parse [ #scope:compiler ] [ #scope:tokenizer_data:token_stream ] [ #scope:tokenizer_data:registry ] #modify [ #data #scope:parser_data ] [ #last ] #call [ #data debug_log ] [ #scope:configuration:debug ] [ #data "building... " ] #build [ #scope:compiler ] [ #scope:parser_data ] #modify [ #data #scope:build_data ] [ #last ] #write_file [ #scope:output_file ] [ #scope:build_data:code ] #system [ #data "rm" ] [ #scope:input_file ] #if [ #data #true ] [ #scope:configuration:caching ] #map [ #data source ] [ #scope:content ] [ #data compiled ] [ #scope:build_data:code ] #modify [ #data #scope:entry ] [ #last ] #overwrite [ #scope:cache ] [ #scope:input_file ] [ #scope:entry ] #modify [ #data #scope:cache ] [ #last ] #end #end #if [ #data #true ] [ #scope:configuration:caching ] #call [ #data save_cache ] [ #scope:configuration:debug ] [ #scope:cache ] #end #time #modify [ #data #scope:_10 ] [ #last ] #subtract [ #scope:_10 ] [ #scope:start_time ] #modify [ #data #scope:_11 ] [ #last ] #divide [ #scope:_11 ] [ #data 1000.0 ] #modify [ #data #scope:delta_time ] [ #last ] #string [ #scope:delta_time ] #modify [ #data #scope:_12 ] [ #last ] #slice [ #scope:_12 ] [ #data 1 ] [ #data 3 ] #modify [ #data #scope:formatted ] [ #last ] #string [ #data "completed in " ] [ #scope:formatted ] [ #data "s" ] #modify [ #data #scope:_13 ] [ #last ] #call [ #data #print:success ] [ #scope:_13 ] ] } 